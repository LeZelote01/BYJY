<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîê G√©n√©rateur de Mots de Passe S√©curis√©s</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .container { margin-top: 30px; }
        .card { border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .form-control, .form-range { margin-bottom: 15px; }
        .password-display { font-family: monospace; font-size: 16px; padding: 15px; }
        .strength-bar { height: 10px; border-radius: 5px; margin-top: 10px; }
        .btn-generate { background: linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%); border: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-primary text-white text-center">
                        <h2>üîê G√©n√©rateur de Mots de Passe S√©curis√©s</h2>
                    </div>
                    <div class="card-body">
                        <!-- G√©n√©rateur -->
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Configuration</h5>
                                <label for="length">Longueur: <span id="lengthValue">12</span></label>
                                <input type="range" class="form-range" id="length" min="4" max="32" value="12">
                                
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="uppercase" checked>
                                    <label class="form-check-label" for="uppercase">Majuscules (A-Z)</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="lowercase" checked>
                                    <label class="form-check-label" for="lowercase">Minuscules (a-z)</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="numbers" checked>
                                    <label class="form-check-label" for="numbers">Chiffres (0-9)</label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="symbols" checked>
                                    <label class="form-check-label" for="symbols">Symboles (!@#$)</label>
                                </div>
                                
                                <button class="btn btn-lg btn-generate text-white w-100 mt-3" onclick="generatePassword()">
                                    üé≤ G√©n√©rer un Mot de Passe
                                </button>
                            </div>
                            
                            <div class="col-md-6">
                                <h5>Mot de Passe G√©n√©r√©</h5>
                                <div id="passwordDisplay" class="alert alert-success password-display">
                                    Cliquez sur "G√©n√©rer" pour cr√©er un mot de passe
                                </div>
                                
                                <div class="d-flex gap-2">
                                    <button class="btn btn-outline-primary" onclick="copyPassword()" id="copyBtn" disabled>
                                        üìã Copier
                                    </button>
                                    <button class="btn btn-outline-secondary" onclick="togglePassword()" id="toggleBtn" disabled>
                                        üëÅÔ∏è Afficher/Masquer
                                    </button>
                                </div>
                                
                                <!-- Analyse de s√©curit√© -->
                                <div class="mt-3">
                                    <h6>Force du Mot de Passe</h6>
                                    <div class="progress">
                                        <div id="strengthBar" class="progress-bar" style="width: 0%"></div>
                                    </div>
                                    <small id="strengthText" class="text-muted"></small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Analyseur -->
                        <hr class="my-4">
                        <div class="row">
                            <div class="col-12">
                                <h5>üîç Analyseur de Mot de Passe</h5>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="analyzePassword" placeholder="Entrez un mot de passe √† analyser">
                                    <button class="btn btn-outline-secondary" onclick="analyzePassword()">Analyser</button>
                                </div>
                                <div id="analysisResult" class="mt-2"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentPassword = '';
        let isPasswordHidden = true;
        
        // Mise √† jour du slider de longueur
        document.getElementById('length').addEventListener('input', function() {
            document.getElementById('lengthValue').textContent = this.value;
        });
        
        async function generatePassword() {
            const settings = {
                length: parseInt(document.getElementById('length').value),
                uppercase: document.getElementById('uppercase').checked,
                lowercase: document.getElementById('lowercase').checked,
                numbers: document.getElementById('numbers').checked,
                symbols: document.getElementById('symbols').checked,
                exclude_similar: true,
                save_to_history: false
            };
            
            try {
                const response = await fetch('/generate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(settings)
                });
                
                const data = await response.json();
                currentPassword = data.password;
                
                // Afficher le mot de passe (masqu√©)
                displayPassword();
                
                // Activer les boutons
                document.getElementById('copyBtn').disabled = false;
                document.getElementById('toggleBtn').disabled = false;
                
                // Analyser automatiquement
                updateStrength(data.strength_analysis);
                
            } catch (error) {
                document.getElementById('passwordDisplay').innerHTML = 
                    '<span class="text-danger">Erreur lors de la g√©n√©ration</span>';
            }
        }
        
        function displayPassword() {
            const display = document.getElementById('passwordDisplay');
            if (isPasswordHidden) {
                display.textContent = '‚Ä¢'.repeat(currentPassword.length);
            } else {
                display.textContent = currentPassword;
            }
        }
        
        function togglePassword() {
            isPasswordHidden = !isPasswordHidden;
            displayPassword();
            document.getElementById('toggleBtn').textContent = 
                isPasswordHidden ? 'üëÅÔ∏è Afficher' : 'üôà Masquer';
        }
        
        function copyPassword() {
            navigator.clipboard.writeText(currentPassword).then(() => {
                const btn = document.getElementById('copyBtn');
                const originalText = btn.textContent;
                btn.textContent = '‚úÖ Copi√© !';
                btn.classList.add('btn-success');
                btn.classList.remove('btn-outline-primary');
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-outline-primary');
                }, 2000);
            });
        }
        
        function updateStrength(analysis) {
            const bar = document.getElementById('strengthBar');
            const text = document.getElementById('strengthText');
            
            const score = analysis.score;
            const level = analysis.level;
            
            bar.style.width = score + '%';
            
            // Couleurs selon le niveau
            bar.classList.remove('bg-danger', 'bg-warning', 'bg-info', 'bg-success', 'bg-primary');
            
            if (score < 20) {
                bar.classList.add('bg-danger');
                text.textContent = `${level} (${score}/100) - ${analysis.crack_time}`;
            } else if (score < 40) {
                bar.classList.add('bg-warning');
                text.textContent = `${level} (${score}/100) - ${analysis.crack_time}`;
            } else if (score < 60) {
                bar.classList.add('bg-info');
                text.textContent = `${level} (${score}/100) - ${analysis.crack_time}`;
            } else if (score < 80) {
                bar.classList.add('bg-success');
                text.textContent = `${level} (${score}/100) - ${analysis.crack_time}`;
            } else {
                bar.classList.add('bg-primary');
                text.textContent = `${level} (${score}/100) - ${analysis.crack_time}`;
            }
        }
        
        async function analyzePassword() {
            const password = document.getElementById('analyzePassword').value;
            if (!password) return;
            
            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({password: password})
                });
                
                const data = await response.json();
                const result = document.getElementById('analysisResult');
                
                result.innerHTML = `
                    <div class="alert alert-info">
                        <strong>Score:</strong> ${data.score}/100 (${data.level})<br>
                        <strong>Temps de crack estim√©:</strong> ${data.crack_time}<br>
                        <strong>Suggestions:</strong> ${data.suggestions.join(', ') || 'Aucune'}
                    </div>
                `;
                
            } catch (error) {
                document.getElementById('analysisResult').innerHTML = 
                    '<div class="alert alert-danger">Erreur lors de l\'analyse</div>';
            }
        }
        
        // G√©n√©rer un mot de passe au chargement
        window.onload = function() {
            generatePassword();
        };
    </script>
</body>
</html>